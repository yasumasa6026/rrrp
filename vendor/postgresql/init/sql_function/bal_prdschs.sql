-- public.bal_prdschs source
drop view if exists  bal_prdschs ;

CREATE OR REPLACE VIEW public.bal_prdschs
AS SELECT chrg.person_name_chrg,
    chrg.person_code_chrg,
    opeitm.itm_name,
    opeitm.itm_code,
    opeitm.unit_name,
    opeitm.unit_code,
    opeitm.itm_unit_id,
    opeitm.opeitm_processseq,
    opeitm.opeitm_packqty,
    opeitm.opeitm_priority,
    opeitm.opeitm_itm_id,
    opeitm.opeitm_duration,
    prdsch.id,
    prjno.prjno_name,
    chrg.person_sect_id_chrg,
    person_upd.code AS person_code_upd,
    person_upd.name AS person_name_upd,
    prdsch.id AS prdsch_id,
    prdsch.remark AS prdsch_remark,
    prdsch.expiredate AS prdsch_expiredate,
    prdsch.update_ip AS prdsch_update_ip,
    prdsch.created_at AS prdsch_created_at,
    prdsch.updated_at AS prdsch_updated_at,
    prdsch.persons_id_upd AS prdsch_person_id_upd,
    prdsch.sno AS prdsch_sno,
    prdsch.duedate AS prdsch_duedate,
    prdsch.toduedate AS prdsch_toduedate,
    prdsch.isudate AS prdsch_isudate,
    prdsch.opeitms_id AS prdsch_opeitm_id,
    shelfno.shelfno_code,
    shelfno.shelfno_name,
    shelfno.shelfno_loca_id_shelfno,
    shelfno.loca_code_shelfno,
    shelfno.loca_name_shelfno,
    prjno.prjno_code,
    prdsch.prjnos_id AS prdsch_prjno_id,
    chrg.chrg_person_id_chrg,
    opeitm.classlist_code,
    opeitm.classlist_name,
    opeitm.boxe_unit_id_box,
    opeitm.boxe_code,
    opeitm.boxe_name,
    opeitm.opeitm_boxe_id,
    prdsch.chrgs_id AS prdsch_chrg_id,
    prdsch.starttime AS prdsch_starttime,
    prjno.prjno_code_chil,
    opeitm.opeitm_unitofduration,
    opeitm.itm_classlist_id,
    shelfno_to.shelfno_code AS shelfno_code_to,
    shelfno_to.shelfno_name AS shelfno_name_to,
    shelfno_to.loca_code_shelfno AS loca_code_shelfno_to,
    shelfno_to.loca_name_shelfno AS loca_name_shelfno_to,
    shelfno_to.shelfno_loca_id_shelfno AS shelfno_loca_id_shelfno_to,
    prdsch.gno AS prdsch_gno,
    prdsch.shelfnos_id_to AS prdsch_shelfno_id_to,
    prdsch.qty_sch AS prdsch_qty_sch,
	func_get_purprd_qty_bal('prdschs',prdsch.id) linktbl_qty_sch_bal,
    prjno.prjno_name_chil,
    opeitm.opeitm_shelfno_id_to_opeitm,
    opeitm.shelfno_code_to_opeitm,
    opeitm.shelfno_name_to_opeitm,
    opeitm.loca_code_shelfno_to_opeitm,
    opeitm.loca_name_shelfno_to_opeitm,
    opeitm.unit_name_case_shp,
    opeitm.unit_code_case_shp,
    opeitm.unit_name_case_prdpur,
    opeitm.unit_code_case_prdpur,
    opeitm.opeitm_shelfno_id_opeitm,
    opeitm.shelfno_code_opeitm,
    opeitm.shelfno_name_opeitm,
    opeitm.shelfno_loca_id_shelfno_opeitm,
    opeitm.loca_code_shelfno_opeitm,
    opeitm.loca_name_shelfno_opeitm,
    prdsch.shelfnos_id AS prdsch_shelfno_id,
    opeitm.opeitm_shpordauto,
    opeitm.opeitm_prdpurordauto,
    opeitm.opeitm_itmtype,
    opeitm.itm_taxflg,
    opeitm.opeitm_utilizationchangeover
   FROM prdschs prdsch,
    persons person_upd,
    r_opeitms opeitm,
    r_prjnos prjno,
    r_chrgs chrg,
    r_shelfnos shelfno_to,
    r_shelfnos shelfno
  WHERE prdsch.persons_id_upd = person_upd.id AND prdsch.opeitms_id = opeitm.id AND prdsch.prjnos_id = prjno.id AND prdsch.chrgs_id = chrg.id AND prdsch.shelfnos_id_to = shelfno_to.id AND prdsch.shelfnos_id = shelfno.id;



-- sio.sio_r_prdschs definition

-- Drop table

DROP TABLE if  exists sio.sio_bal_prdschs ;

CREATE TABLE sio.sio_bal_prdschs (
	sio_id numeric(22) NOT NULL,
	sio_user_code numeric(22) NULL,
	sio_term_id varchar(30) NULL,
	sio_session_id numeric(22) NULL,
	sio_command_response bpchar(1) NULL,
	sio_session_counter numeric(22) NULL,
	sio_classname varchar(50) NULL,
	sio_viewname varchar(30) NULL,
	sio_code varchar(30) NULL,
	sio_strsql varchar(4000) NULL,
	sio_totalcount numeric(22) NULL,
	sio_recordcount numeric(22) NULL,
	sio_start_record numeric(22) NULL,
	sio_end_record numeric(22) NULL,
	sio_sord varchar(256) NULL,
	sio_search varchar(10) NULL,
	sio_sidx varchar(256) NULL,
	prdsch_isudate timestamp(6) NULL,
	prdsch_sno varchar(50) NULL,
	itm_code varchar(50) NULL,
	opeitm_processseq numeric(3) NULL,
	itm_name varchar(100) NULL,
	prdsch_qty_sch numeric(22, 6) NULL,
	linktbl_qty_sch_bal numeric(22, 6) NULL,
	prdsch_duedate timestamp(6) NULL,
	prdsch_starttime timestamp(6) NULL,
	opeitm_priority numeric(3) NULL,
	loca_code_shelfno varchar(50) NULL,
	loca_name_shelfno varchar(100) NULL,
	shelfno_code varchar(50) NULL,
	shelfno_name varchar(100) NULL,
	loca_code_shelfno_to varchar(50) NULL,
	loca_name_shelfno_to varchar(100) NULL,
	shelfno_code_to varchar(50) NULL,
	shelfno_name_to varchar(100) NULL,
	loca_code_shelfno_opeitm varchar(50) NULL,
	loca_name_shelfno_opeitm varchar(100) NULL,
	shelfno_code_opeitm varchar(50) NULL,
	shelfno_name_opeitm varchar(100) NULL,
	loca_code_shelfno_to_opeitm varchar(50) NULL,
	shelfno_code_to_opeitm varchar(50) NULL,
	loca_name_shelfno_to_opeitm varchar(100) NULL,
	shelfno_name_to_opeitm varchar(100) NULL,
	prdsch_toduedate timestamp(6) NULL,
	person_code_chrg varchar(50) NULL,
	person_name_chrg varchar(100) NULL,
	prjno_code varchar(50) NULL,
	prjno_name varchar(100) NULL,
	prdsch_expiredate date NULL,
	classlist_name varchar(100) NULL,
	classlist_code varchar(50) NULL,
	person_code_upd varchar(50) NULL,
	person_name_upd varchar(100) NULL,
	opeitm_duration numeric(38, 2) NULL,
	unit_code varchar(50) NULL,
	unit_name varchar(100) NULL,
	unit_code_case_prdpur varchar(50) NULL,
	unit_name_case_prdpur varchar(100) NULL,
	unit_code_case_shp varchar(50) NULL,
	unit_name_case_shp varchar(100) NULL,
	boxe_code varchar(50) NULL,
	boxe_name varchar(100) NULL,
	prjno_name_chil varchar(100) NULL,
	opeitm_unitofduration varchar(4) NULL,
	opeitm_packqty numeric(38) NULL,
	prjno_code_chil varchar(50) NULL,
	prdsch_gno varchar(40) NULL,
	prdsch_shelfno_id numeric(38) NULL,
	opeitm_shpordauto varchar(1) NULL,
	opeitm_prdpurordauto varchar(1) NULL,
	opeitm_itmtype varchar(1) NULL,
	itm_taxflg varchar(20) NULL,
	opeitm_utilizationchangeover numeric(3, 2) NULL,
	prdsch_remark varchar(4000) NULL,
	prdsch_chrg_id numeric(38) NULL,
	opeitm_shelfno_id_to_opeitm numeric(38) NULL,
	opeitm_boxe_id numeric(22) NULL,
	boxe_unit_id_box numeric(38) NULL,
	opeitm_itm_id numeric(38) NULL,
	chrg_person_id_chrg numeric(38) NULL,
	prdsch_prjno_id numeric(38) NULL,
	shelfno_loca_id_shelfno numeric(38) NULL,
	prdsch_update_ip varchar(40) NULL,
	opeitm_shelfno_id_opeitm numeric(22) NULL,
	itm_unit_id numeric(22) NULL,
	prdsch_created_at timestamp(6) NULL,
	shelfno_loca_id_shelfno_opeitm numeric(38) NULL,
	prdsch_opeitm_id numeric(38) NULL,
	itm_classlist_id numeric(38) NULL,
	prdsch_person_id_upd numeric(38) NULL,
	person_sect_id_chrg numeric(22) NULL,
	prdsch_id numeric(38) NULL,
	shelfno_loca_id_shelfno_to numeric(38) NULL,
	prdsch_updated_at timestamp(6) NULL,
	id numeric(38) NULL,
	prdsch_shelfno_id_to numeric(38) NULL,
	sio_errline varchar(4000) NULL,
	sio_org_tblname varchar(30) NULL,
	sio_org_tblid numeric(22) NULL,
	sio_add_time date NULL,
	sio_replay_time date NULL,
	sio_result_f bpchar(1) NULL,
	sio_message_code bpchar(10) NULL,
	sio_message_contents varchar(4000) NULL,
	sio_chk_done bpchar(1) NULL,
	CONSTRAINT sio_bal_prdschs_id_pk PRIMARY KEY (sio_id)
);
CREATE INDEX sio_bal_prdschs_uk1 ON sio.sio_bal_prdschs USING btree (id, sio_id);