-- public.forinsts_shpords source
drop view if  exists  public.forinsts_shpords;
CREATE OR REPLACE VIEW public.forinsts_shpords
AS SELECT chrg.person_name_chrg,
    chrg.person_code_chrg,
    itm.itm_name,
    itm.itm_code,
    itm.unit_name,
    itm.unit_code,
    itm.itm_unit_id,
    shpord.units_id_case_shp AS shpord_unit_id_case_shp,
    transport.transport_code,
    transport.transport_name,
    shpord.qty AS shpord_qty,
    func_get_shelfnos_stk(shpord.itms_id ,shpord.processseq ,shpord.shelfnos_id_fm,shpord.prjnos_id) as forInstsShpord_qty_stk_shelfno,
    func_get_locas_stk(shpord.itms_id ,shpord.processseq ,shelfno_fm.shelfno_loca_id_shelfno) as forInstsShpord_qty_stk_loca,
    func_get_free_stk(shpord.prjnos_id,shpord.itms_id ,shpord.processseq ) as forInstsShpord_qty_stk_free,
    shpord.sno AS shpord_sno,
    shpord.update_ip AS shpord_update_ip,
    shpord.updated_at AS shpord_updated_at,
    shpord.isudate AS shpord_isudate,
    shpord.persons_id_upd AS shpord_person_id_upd,
    shpord.id AS shpord_id,
    shpord.duedate AS shpord_duedate,
    shpord.created_at AS shpord_created_at,
    shpord.id,
    shpord.expiredate AS shpord_expiredate,
    case when shpord.depdate is null then current_date else shpord.depdate end  AS shpord_depdate,
    shpord.price AS shpord_price,
    shpord.itms_id AS shpord_itm_id,
    shpord.remark AS shpord_remark,
    shpord.amt AS shpord_amt,
    shpord.taxrate  AS shpord_taxrate,
    prjno.prjno_name,
    chrg.person_sect_id_chrg,
    person_upd.person_code AS person_code_upd,
    person_upd.person_name AS person_name_upd,
    prjno.prjno_code,
    chrg.chrg_person_id_chrg,
    itm.classlist_code,
    itm.classlist_name,
    crr.crr_code,
    crr.crr_name,
    crr.crr_decimal,
    shpord.chrgs_id AS shpord_chrg_id,
    shpord.gno AS shpord_gno,
    shpord.processseq AS shpord_processseq,
    shpord.prjnos_id AS shpord_prjno_id,
    shpord.contractprice AS shpord_contractprice,
    shpord.qty_case AS shpord_qty_case,
    shpord.lotno AS shpord_lotno,
    shpord.packno AS shpord_packno,
    prjno.prjno_code_chil,
    shpord.transports_id AS shpord_transport_id,
    itm.itm_classlist_id,
    shelfno_to.shelfno_code AS shelfno_code_to,
    shelfno_to.shelfno_name AS shelfno_name_to,
    shelfno_to.loca_code_shelfno AS loca_code_shelfno_to,
    shelfno_to.loca_name_shelfno AS loca_name_shelfno_to,
    shelfno_to.shelfno_loca_id_shelfno AS shelfno_loca_id_shelfno_to,
    shelfno_fm.shelfno_code AS shelfno_code_fm,
    shelfno_fm.shelfno_name AS shelfno_name_fm,
    shelfno_fm.loca_code_shelfno AS loca_code_shelfno_fm,
    shelfno_fm.loca_name_shelfno AS loca_name_shelfno_fm,
    shelfno_fm.shelfno_loca_id_shelfno AS shelfno_loca_id_shelfno_fm,
    shpord.crrs_id AS shpord_crr_id,
    shpord.paretblname AS shpord_paretblname,
    shpord.paretblid AS shpord_paretblid,
    shpord.shelfnos_id_fm AS shpord_shelfno_id_fm,
    prjno.prjno_name_chil,
    shpord.qty_shortage AS shpord_qty_shortage,
    shpord.shelfnos_id_to AS shpord_shelfno_id_to
   FROM shpords shpord,
    r_persons person_upd,
    r_itms itm,
    r_chrgs chrg,
    r_prjnos prjno,
    r_transports transport,
    r_crrs crr,
    r_shelfnos shelfno_fm,
    r_shelfnos shelfno_to
  WHERE shpord.persons_id_upd = person_upd.id AND shpord.itms_id = itm.id AND shpord.chrgs_id = chrg.id AND shpord.prjnos_id = prjno.id AND shpord.transports_id = transport.id AND shpord.crrs_id = crr.id AND shpord.shelfnos_id_fm = shelfno_fm.id AND shpord.shelfnos_id_to = shelfno_to.id;
  
 
 
 
 -- sio.sio_forinsts_shpords definition

-- Drop table

DROP TABLE sio.sio_forinsts_shpords;

CREATE TABLE sio.sio_forinsts_shpords (
	sio_id numeric(22) NOT NULL,
	sio_user_code numeric(22) NULL,
	sio_term_id varchar(30) NULL,
	sio_session_id numeric(22) NULL,
	sio_command_response bpchar(1) NULL,
	sio_session_counter numeric(22) NULL,
	sio_classname varchar(50) NULL,
	sio_viewname varchar(30) NULL,
	sio_code varchar(30) NULL,
	sio_strsql varchar(4000) NULL,
	sio_totalcount numeric(22) NULL,
	sio_recordcount numeric(22) NULL,
	sio_start_record numeric(22) NULL,
	sio_end_record numeric(22) NULL,
	sio_sord varchar(256) NULL,
	sio_search varchar(10) NULL,
	sio_sidx varchar(256) NULL,
	forInstsShpord_qty_stk_shelfno numeric(22) NULL,
    forInstsShpord_qty_stk_loca numeric(22) NULL,
    forInstsShpord_qty_stk_free numeric(22) NULL,
	shpord_isudate timestamp(6) NULL,
	shpord_paretblname varchar(30) NULL,
	shpord_paretblid numeric(38) NULL,
	shpord_depdate timestamp(6) NULL,
	itm_code varchar(50) NULL,
	itm_name varchar(100) NULL,
	shpord_processseq numeric(38) NULL,
	shpord_qty numeric(22, 6) NULL,
	shpord_qty_shortage numeric(22, 5) NULL,
	shpord_qty_case numeric(22) NULL,
	shpord_lotno varchar(50) NULL,
	shpord_packno varchar(10) NULL,
	shpord_duedate timestamp(6) NULL,
	loca_code_shelfno_fm varchar(50) NULL,
	loca_name_shelfno_fm varchar(100) NULL,
	shelfno_code_fm varchar(50) NULL,
	shelfno_name_fm varchar(100) NULL,
	loca_code_shelfno_to varchar(50) NULL,
	loca_name_shelfno_to varchar(100) NULL,
	shelfno_code_to varchar(50) NULL,
	shelfno_name_to varchar(100) NULL,
	shpord_sno varchar(40) NULL,
	shpord_gno varchar(40) NULL,
	unit_code varchar(50) NULL,
	unit_name varchar(100) NULL,
	transport_code varchar(50) NULL,
	transport_name varchar(100) NULL,
	crr_code varchar(50) NULL,
	crr_name varchar(100) NULL,
	shpord_price numeric(38, 4) NULL,
	shpord_amt numeric(18, 4) NULL,
	shpord_taxrate numeric(38, 4) NULL,
	shpord_contractprice varchar(1) NULL,
	prjno_code varchar(50) NULL,
	prjno_name varchar(100) NULL,
	prjno_code_chil varchar(50) NULL,
	prjno_name_chil varchar(100) NULL,
	person_code_chrg varchar(50) NULL,
	person_name_chrg varchar(100) NULL,
	classlist_code varchar(50) NULL,
	classlist_name varchar(100) NULL,
	shpord_crr_id numeric(22) NULL,
	crr_decimal numeric(22) NULL,
	shpord_srctblid numeric(38) NULL,
	shpord_remark varchar(4000) NULL,
	person_code_upd varchar(50) NULL,
	person_name_upd varchar(100) NULL,
	shpord_expiredate date NULL,
	shelfno_loca_id_shelfno_to numeric(38) NULL,
	chrg_person_id_chrg numeric(38) NULL,
	shpord_chrg_id numeric(38) NULL,
	shpord_prjno_id numeric(38) NULL,
	shpord_unit_id_case_shp numeric(38) NULL,
	shpord_itm_id numeric(38) NULL,
	shpord_transport_id numeric(38) NULL,
	itm_classlist_id numeric(38) NULL,
	id numeric(38) NULL,
	shpord_created_at timestamp(6) NULL,
	person_sect_id_chrg numeric(22) NULL,
	shpord_id numeric(38) NULL,
	shpord_person_id_upd numeric(38) NULL,
	shpord_updated_at timestamp(6) NULL,
	shpord_update_ip varchar(40) NULL,
	shelfno_loca_id_shelfno_fm numeric(38) NULL,
	itm_unit_id numeric(22) NULL,
	shpord_shelfno_id_fm numeric(22) NULL,
	shpord_srctblname varchar(30) NULL,
	shpord_shelfno_id_to numeric(38) NULL,
	sio_errline varchar(4000) NULL,
	sio_add_time date NULL,
	sio_replay_time date NULL,
	sio_result_f bpchar(1) NULL,
	sio_message_code bpchar(10) NULL,
	sio_message_contents varchar(4000) NULL,
	sio_chk_done bpchar(1) NULL,
	CONSTRAINT sio_forinsts_shpords_id_pk PRIMARY KEY (sio_id)
);
CREATE INDEX sio_forinsts_shpords_uk1 ON sio.sio_forinsts_shpords USING btree (id, sio_id);



 drop sequence  if exists sio.sio_forinsts_shpords_seq ;
 create sequence sio.sio_forinsts_shpords_seq ;