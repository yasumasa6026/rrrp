drop view if exists public.foract_shpinsts ;
CREATE OR REPLACE VIEW public.foract_shpinsts
AS SELECT shpinst.packno AS shpinst_packno,
        CASE
            WHEN shpinst.rcptdate IS NULL THEN CURRENT_DATE::timestamp without time zone
            ELSE shpinst.rcptdate
        END AS shpinst_rcptdate,
    shpinst.lotno AS shpinst_lotno,
    chrg.person_name_chrg,
    chrg.person_code_chrg,
    itm.itm_name,
    itm.itm_code,
    itm.unit_name,
    itm.unit_code,
    itm.itm_unit_id,
    transport.transport_code,
    transport.transport_name,
    shpinst.id,
    shpinst.tax AS shpinst_tax,
    shpinst.cartonno AS shpinst_cartonno,
    shpinst.expiredate AS shpinst_expiredate,
    shpinst.updated_at AS shpinst_updated_at,
    shpinst.sno AS shpinst_sno,
    shpinst.price AS shpinst_price,
    shpinst.itms_id AS shpinst_itm_id,
    shpinst.remark AS shpinst_remark,
    shpinst.created_at AS shpinst_created_at,
    shpinst.amt AS shpinst_amt,
    shpinst.update_ip AS shpinst_update_ip,
    shpinst.id AS shpinst_id,
    prjno.prjno_name,
    chrg.person_sect_id_chrg,
    person_upd.code AS person_code_upd,
    person_upd.name AS person_name_upd,
    prjno.prjno_code,
    chrg.chrg_person_id_chrg,
    itm.classlist_code,
    itm.classlist_name,
    shpinst.gno AS shpinst_gno,
    shpinst.isudate AS shpinst_isudate,
    shpinst.prjnos_id AS shpinst_prjno_id,
    shpinst.persons_id_upd AS shpinst_person_id_upd,
    shpinst.contents AS shpinst_contents,
    shpinst.contractprice AS shpinst_contractprice,
    shpinst.chrgs_id AS shpinst_chrg_id,
    shpinst.crrs_id AS shpinst_crr_id,
    shpinst.box AS shpinst_box,
    shpinst.cno AS shpinst_cno,
    shpinst.qty_case AS shpinst_qty_case,
    prjno.prjno_code_chil,
    shpinst.transports_id AS shpinst_transport_id,
    itm.itm_classlist_id,
    shelfno_fm.shelfno_code AS shelfno_code_fm,
    shelfno_fm.shelfno_name AS shelfno_name_fm,
    shelfno_fm.loca_code_shelfno AS loca_code_shelfno_fm,
    shelfno_fm.loca_name_shelfno AS loca_name_shelfno_fm,
    shelfno_fm.shelfno_loca_id_shelfno AS shelfno_loca_id_shelfno_fm,
    shpinst.shelfnos_id_fm AS shpinst_shelfno_id_fm,
    shelfno_to.shelfno_code AS shelfno_code_to,
    shelfno_to.shelfno_name AS shelfno_name_to,
    shelfno_to.loca_code_shelfno AS loca_code_shelfno_to,
    shelfno_to.loca_name_shelfno AS loca_name_shelfno_to,
    shelfno_to.shelfno_loca_id_shelfno AS shelfno_loca_id_shelfno_to,
    shpinst.shelfnos_id_to AS shpinst_shelfno_id_to,
    shpinst.processseq AS shpinst_processseq,
    shpinst.depdate AS shpinst_depdate,
    shpinst.paretblname AS shpinst_paretblname,
    shpinst.paretblid AS shpinst_paretblid,
    shpinst.qty_shortage AS shpinst_qty_shortage,
    shpinst.qty_stk AS shpinst_qty_stk,
    prjno.prjno_name_chil,
    unit_case_shp.unit_name AS unit_name_case_shp,
    unit_case_shp.unit_code AS unit_code_case_shp,
    shpinst.units_id_case_shp AS shpinst_unit_id_case_shp,
    shpinst.qty_real AS shpinst_qty_real
   FROM shpinsts shpinst,
    r_itms itm,
    r_prjnos prjno,
    persons person_upd,
    r_chrgs chrg,
    r_transports transport,
    r_units unit_case_shp,
    r_shelfnos shelfno_to,
    r_shelfnos shelfno_fm
  WHERE shpinst.itms_id = itm.id AND shpinst.prjnos_id = prjno.id AND shpinst.persons_id_upd = person_upd.id 
		AND shpinst.chrgs_id = chrg.id AND shpinst.transports_id = transport.id AND shpinst.units_id_case_shp = unit_case_shp.id 
		AND shpinst.shelfnos_id_to = shelfno_to.id and shpinst.shelfnos_id_fm = shelfno_fm.id;