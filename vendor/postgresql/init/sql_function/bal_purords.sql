drop view if exists public.bal_purords ;
CREATE VIEW public.bal_purords AS
 SELECT 
 	purord.confirm purord_confirm,
 	chrg.person_name_chrg,
    chrg.person_code_chrg,
    opeitm.itm_name,
    opeitm.itm_code,
    opeitm.unit_name,
    opeitm.unit_code,
    opeitm.itm_unit_id,
    opeitm.opeitm_processseq,
    opeitm.opeitm_packqty,
    opeitm.opeitm_priority,
    opeitm.opeitm_itm_id,
    opeitm.opeitm_duration,
    purord.id,
    prjno.prjno_name,
    chrg.person_sect_id_chrg,
    person_upd.code AS person_code_upd,
    person_upd.name AS person_name_upd,
    purord.id AS purord_id,
    purord.remark AS purord_remark,
    purord.expiredate AS purord_expiredate,
    purord.update_ip AS purord_update_ip,
    purord.created_at AS purord_created_at,
    purord.updated_at AS purord_updated_at,
    purord.persons_id_upd AS purord_person_id_upd,
    purord.price AS purord_price,
    purord.masterprice AS purord_masterprice,
    purord.sno AS purord_sno,
    purord.duedate AS purord_duedate,
    purord.toduedate AS purord_toduedate,
    purord.isudate AS purord_isudate,
    purord.tax AS purord_tax,
    purord.cmplflg AS purord_cmplflg,
    purord.opeitms_id AS purord_opeitm_id,
    prjno.prjno_code,
    purord.prjnos_id AS purord_prjno_id,
    chrg.chrg_person_id_chrg,
    opeitm.classlist_code,
    opeitm.classlist_name,
    crr.code AS crr_code,
    crr.name AS crr_name,
    opeitm.boxe_unit_id_box,
    opeitm.boxe_code,
    opeitm.boxe_name,
    opeitm.opeitm_boxe_id,
    purord.chrgs_id AS purord_chrg_id,
    purord.starttime AS purord_starttime,
    prjno.prjno_code_chil,
    opeitm.opeitm_unitofduration,
    supplier.supplier_loca_id_supplier,
    supplier.supplier_chrg_id_supplier,
    supplier.supplier_crr_id_supplier,
    supplier.loca_code_supplier,
    supplier.loca_name_supplier,
    supplier.person_code_chrg_supplier,
    supplier.person_name_chrg_supplier,
    supplier.crr_name_supplier,
    supplier.crr_code_supplier,
    opeitm.itm_classlist_id,
    purord.suppliers_id AS purord_supplier_id,
    purord.gno AS purord_gno,
    shelfno_to.shelfno_code AS shelfno_code_to,
    shelfno_to.shelfno_name AS shelfno_name_to,
    shelfno_to.loca_code_shelfno AS loca_code_shelfno_to,
    shelfno_to.loca_name_shelfno AS loca_name_shelfno_to,
    shelfno_to.shelfno_loca_id_shelfno AS shelfno_loca_id_shelfno_to,
    purord.shelfnos_id_to AS purord_shelfno_id_to,
    purord.crrs_id AS purord_crr_id,
    purord.qty AS purord_qty,
    public.func_get_purprd_qty_bal('purords'::text, purord.id) AS link_qty_bal,
    purord.amt AS purord_amt,
    prjno.prjno_name_chil,
    opeitm.shelfno_code_to_opeitm,
    opeitm.shelfno_name_to_opeitm,
    opeitm.loca_code_shelfno_to_opeitm,
    opeitm.loca_name_shelfno_to_opeitm,
    opeitm.unit_name_case_shp,
    opeitm.unit_code_case_shp,
    opeitm.unit_name_case_prdpur,
    opeitm.unit_code_case_prdpur,
    supplier.loca_code_payment_supplier,
    supplier.loca_name_payment_supplier,
    supplier.person_code_chrg_payment_supplier,
    supplier.person_name_chrg_payment_supplier,
    supplier.crr_code_payment_supplier,
    supplier.crr_name_payment_supplier,
    opeitm.opeitm_shelfno_id_opeitm,
    opeitm.shelfno_code_opeitm,
    opeitm.shelfno_name_opeitm,
    opeitm.shelfno_loca_id_shelfno_opeitm,
    opeitm.loca_code_shelfno_opeitm,
    opeitm.loca_name_shelfno_opeitm,
    purord.itm_code_client AS purord_itm_code_client,
    opeitm.opeitm_shpordauto,
    opeitm.opeitm_prdpurordauto,
    opeitm.opeitm_itmtype,
    purord.taxrate AS purord_taxrate,
    opeitm.itm_taxflg,
    purord.contents AS purord_contents,
    purord.contractprice AS purord_contractprice
   FROM public.purords purord,
    public.persons person_upd,
    public.r_opeitms opeitm,
    public.r_prjnos prjno,
    public.r_chrgs chrg,
    public.r_suppliers supplier,
    public.r_shelfnos shelfno_to,
    public.crrs crr
  WHERE ((purord.persons_id_upd = person_upd.id) AND (purord.opeitms_id = opeitm.id) AND (purord.prjnos_id = prjno.id) AND (purord.chrgs_id = chrg.id) 
 AND (purord.suppliers_id = supplier.id) AND (purord.shelfnos_id_to = shelfno_to.id) AND (purord.crrs_id = crr.id) )
--- and public.func_get_purprd_qty_bal('purords'::text, purord.id)  > 0
;


 
 DROP TABLE sio.sio_bal_purords;

CREATE TABLE sio.sio_bal_purords (
	sio_id numeric(22) NOT NULL,
	sio_user_code numeric(22) NULL,
	sio_term_id varchar(30) NULL,
	sio_session_id numeric(22) NULL,
	sio_command_response bpchar(1) NULL,
	sio_session_counter numeric(22) NULL,
	sio_classname varchar(50) NULL,
	sio_viewname varchar(30) NULL,
	sio_code varchar(30) NULL,
	sio_strsql varchar(4000) NULL,
	sio_totalcount numeric(22) NULL,
	sio_recordcount numeric(22) NULL,
	sio_start_record numeric(22) NULL,
	sio_end_record numeric(22) NULL,
	sio_sord varchar(256) NULL,
	sio_search varchar(10) NULL,
	sio_sidx varchar(256) NULL,
	purord_confirm bpchar(1) NULL,
	purord_sno varchar(50) NULL,
	purord_isudate timestamp(6) NULL,
	itm_code varchar(50) NULL,
	itm_name varchar(100) NULL,
	opeitm_processseq numeric(3) NULL,
	loca_code_shelfno_opeitm varchar(50) NULL,
	loca_name_shelfno_opeitm varchar(100) NULL,
	shelfno_code_opeitm varchar(50) NULL,
	shelfno_name_opeitm varchar(100) NULL,
	opeitm_priority numeric(3) NULL,
	purord_duedate timestamp(6) NULL,
	purord_starttime timestamp(6) NULL,
	purord_qty numeric(18, 4) NULL,
	link_qty_bal numeric(18, 4) NULL,
	opeitm_packqty numeric(38) NULL,
	purord_price numeric(38, 4) NULL,
	purord_amt numeric(18, 4) NULL,
	loca_code_shelfno_to_opeitm varchar(50) NULL,
	loca_name_shelfno_to_opeitm varchar(100) NULL,
	shelfno_code_to_opeitm varchar(50) NULL,
	shelfno_name_to_opeitm varchar(100) NULL,
	prjno_code varchar(50) NULL,
	prjno_name varchar(100) NULL,
	person_code_chrg varchar(50) NULL,
	person_name_chrg varchar(100) NULL,
	purord_itm_code_client varchar(50) NULL,
	loca_code_shelfno_to varchar(50) NULL,
	loca_name_shelfno_to varchar(100) NULL,
	shelfno_code_to varchar(50) NULL,
	shelfno_name_to varchar(100) NULL,
	unit_code varchar(50) NULL,
	unit_name varchar(100) NULL,
	classlist_code varchar(50) NULL,
	classlist_name varchar(100) NULL,
	boxe_code varchar(50) NULL,
	boxe_name varchar(100) NULL,
	purord_toduedate timestamp(6) NULL,
	purord_expiredate date NULL,
	crr_code varchar(50) NULL,
	crr_name varchar(100) NULL,
	crr_code_supplier varchar(50) NULL,
	unit_code_case_shp varchar(50) NULL,
	unit_code_case_prdpur varchar(50) NULL,
	loca_code_payment_supplier varchar(50) NULL,
	opeitm_duration numeric(38, 2) NULL,
	person_code_chrg_payment_supplier varchar(50) NULL,
	loca_code_supplier varchar(50) NULL,
	person_code_chrg_supplier varchar(50) NULL,
	crr_code_payment_supplier varchar(50) NULL,
	loca_name_payment_supplier varchar(100) NULL,
	loca_name_supplier varchar(100) NULL,
	person_name_chrg_supplier varchar(100) NULL,
	crr_name_supplier varchar(100) NULL,
	unit_name_case_shp varchar(100) NULL,
	unit_name_case_prdpur varchar(100) NULL,
	person_name_chrg_payment_supplier varchar(100) NULL,
	crr_name_payment_supplier varchar(100) NULL,
	purord_gno varchar(40) NULL,
	opeitm_unitofduration varchar(4) NULL,
	purord_cmplflg varchar(1) NULL,
	purord_crr_id numeric(22) NULL,
	purord_supplier_id numeric(22) NULL,
	purord_taxrate numeric(2) NULL,
	purord_contractprice varchar(1) NULL,
	purord_contents varchar(4000) NULL,
	purord_tax numeric(38, 4) NULL,
	opeitm_itmtype varchar(1) NULL,
	opeitm_prdpurordauto varchar(1) NULL,
	opeitm_shpordauto varchar(1) NULL,
	purord_masterprice numeric(38, 4) NULL,
	itm_taxflg varchar(20) NULL,
	purord_remark varchar(4000) NULL,
	person_code_upd varchar(50) NULL,
	person_name_upd varchar(100) NULL,
	supplier_loca_id_supplier numeric(22) NULL,
	boxe_unit_id_box numeric(38) NULL,
	purord_shelfno_id_to numeric(38) NULL,
	purord_chrg_id numeric(38) NULL,
	shelfno_loca_id_shelfno_to numeric(38) NULL,
	purord_prjno_id numeric(38) NULL,
	purord_update_ip varchar(40) NULL,
	purord_created_at timestamp(6) NULL,
	purord_updated_at timestamp(6) NULL,
	purord_id numeric(38) NULL,
	purord_opeitm_id numeric(38) NULL,
	id numeric(38) NULL,
	opeitm_shelfno_id_opeitm numeric(22) NULL,
	purord_person_id_upd numeric(38) NULL,
	shelfno_loca_id_shelfno_opeitm numeric(38) NULL,
	supplier_chrg_id_supplier numeric(22) NULL,
	supplier_crr_id_supplier numeric(22) NULL,
	--- supplier_contractprice varchar(1) NULL,
	opeitm_itm_id numeric(38) NULL,
	itm_classlist_id numeric(38) NULL,
	opeitm_boxe_id numeric(22) NULL,
	chrg_person_id_chrg numeric(38) NULL,
	itm_unit_id numeric(22) NULL,
	person_sect_id_chrg numeric(22) NULL,
	sio_errline varchar(4000) NULL,
	sio_org_tblname varchar(30) NULL,
	sio_org_tblid numeric(22) NULL,
	sio_add_time date NULL,
	sio_replay_time date NULL,
	sio_result_f bpchar(1) NULL,
	sio_message_code bpchar(10) NULL,
	sio_message_contents varchar(4000) NULL,
	sio_chk_done bpchar(1) NULL,
	CONSTRAINT sio_bal_purords_id_pk PRIMARY KEY (sio_id)
);

CREATE INDEX sio_bal_purords_uk1 ON sio.sio_bal_purords USING btree (id, sio_id);